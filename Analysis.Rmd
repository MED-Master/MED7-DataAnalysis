---
title: "MED7_Analysis"
output: 
  html_document: default
  pdf_document: default
editor_options:
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(scipen=999)
library(ggplot2)
library(tidyverse)
library(tidymodels)
library(skimr)
library(stringr)
library(corrplot)
library(RColorBrewer)
library("PerformanceAnalytics")
library("Hmisc")
library(Rmisc)
library(lubridate)
library(ggbeeswarm)
library(GGally)
library(effsize)
library(magrittr)
library(dplyr)
library(reticulate)
library(raster)
library(sf)
```

```{r logData, echo=FALSE,message=F, warning=F,results='hide'}
df.physio <- list.files(path = "./MED7 Eval data Physiological", full.names = T) %>%
map_dfr(read_csv, .id = "file_path") %>%
group_by(file_path) %>%
dplyr::mutate(ParticipantID = group_indices())

df.sample <- list.files(recursive = TRUE, path = "./MED7 testLogs", pattern = "Sample.csv",full.names = T) %>%
map_dfr(read_csv, .id = "file_path") %>%
group_by(file_path) %>%
dplyr::mutate(ParticipantID = group_indices())
df.sample <- df.sample %>% mutate(
                    minute = minute(Timestamp),
                    second = second(Timestamp))
df.sample <- df.sample %>% dplyr::select(-Timestamp, -Framecount, -SessionID, -Email, -Event, -ParticipantID)
df.sample[df.sample == 'NULL'] <- NA

df.event <- list.files(recursive = TRUE, path = "./MED7 testLogs", pattern = "Event.csv",full.names = T) %>%
map_dfr(read_csv, .id = "file_path") %>%
group_by(file_path) %>%
dplyr::mutate(ParticipantID = group_indices())
df.event <- df.event %>% mutate(
                    minute = minute(Timestamp),
                    second = second(Timestamp))
df.event <- df.event %>% dplyr::select(-Framecount, -SessionID, -Email, -ParticipantID, -Timestamp)
df.event[df.event == 'NULL'] <- NA


physiosummary <- df.physio %>% dplyr::group_by(file_path) %>%  dplyr::select(file_path, EDA, IBI, -ParticipantID, TimeStamp) 
samplesummary <- df.sample %>% dplyr::group_by(file_path)
eventsummary <- df.event %>% dplyr::group_by(file_path)

```

```{r Overview}
 #dfSummary <- df %>%
 #  dplyr::group_by(Participant) %>%
 #  select(Participant, EDA, IBI)
#dfSummary[dfSummary = 0] <- NA
physiosummary  %>%
  select(-file_path) %>%
   skim()

samplesummary %>%
  select(-file_path) %>%
   skim()

```
```{r Hand tracking data}
right.df <- data.frame( x = samplesummary$RightControllerPosWorldX,
y = samplesummary$RightControllerPosWorldY,
z = samplesummary$RightControllerPosWorldZ,
group = samplesummary$file_path)
right.df <- st_as_sf(right.df,coords = c("x","y","z"),remove = F)
right.df <- right.df %>%
  group_by(group) %>%
  dplyr::mutate(
    lead = geometry[(dplyr::row_number()) + 1],
    dist = st_distance(geometry, lead, by_element = T),
  )
samplesummary$righthanddist <- right.df$dist

left.df <- data.frame( x = samplesummary$LeftControllerPosTravelX,
y = samplesummary$LeftControllerPosWorldY,
z = samplesummary$LeftControllerPosWorldZ,
group = samplesummary$file_path)
left.df <- st_as_sf(left.df,coords = c("x","y","z"),remove = F)
left.df <- left.df %>%
  group_by(group) %>%
  dplyr::mutate(
    lead = geometry[(dplyr::row_number()) + 1],
    dist = st_distance(geometry, lead, by_element = T),
  )
samplesummary$lefthanddist <- left.df$dist
```

```{r Head tracking data}
head.df <- data.frame( x = samplesummary$HeadCameraPosWorldX,
y = samplesummary$HeadCameraPosWorldY,
z = samplesummary$HeadCameraPosWorldZ,
group = samplesummary$file_path)

head.df <- st_as_sf(head.df,coords = c("x","y","z"),remove = F)

head.df <- head.df %>%
  group_by(group) %>%
  dplyr::mutate(
    lead = geometry[(dplyr::row_number()) + 1],
    dist = st_distance(geometry, lead, by_element = T),
  )

samplesummary$headdist <- head.df$dist
```

```{python}
import matplotlib.pyplot as plt
from scipy import stats as sc
import pandas as pd

#py_dfSummary = r.dfSummary
#x = py_dfSummary["EDA"]
#y = py_dfSummary["IBI"]
#plt.scatter(x, y)
#plt.show()

py_dsSummary = r.samplesummary
x2 = py_dsSummary["RightControllerPosWorldX"]
y2 = py_dsSummary["RightControllerPosWorldY"]
users = py_dsSummary["Participant"]
plt.scatter(x2, y2)
plt.show()

slope, intercept, p, r2, std_err = sc.linregress(x2, y2)

def lr(x2):
  return slope * x2 + intercept

mymodel = list(map(lr, x2))

p_df = pd.DataFrame(x2, y2, users)
fig, ax = plt.subplots()
bp = p_df.groupby("users").plot(kind="kde", ax=ax)


plt.scatter(x2, y2)
plt.plot(x2, mymodel)
plt.show()

```

```{python}
import numpy as np
my_python_array = np.array([2,4,6,8])
for item in my_python_array:
    print(item)
    
exit
```

